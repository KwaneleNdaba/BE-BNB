{"version":3,"sources":["../../src/services/users.service.ts"],"sourcesContent":["import { hash } from 'bcrypt';\r\nimport { Service } from 'typedi';\r\nimport { HttpException } from '@exceptions/HttpException';\r\nimport { User } from '@interfaces/users.interface';\r\nimport { UserModel } from '@models/users.model';\r\n\r\n@Service()\r\nexport class UserService {\r\n  public async findAllUser(): Promise<User[]> {\r\n    const users: User[] = await UserModel.find();\r\n    return users;\r\n  }\r\n\r\n  public async findUserById(userId: string): Promise<User> {\r\n    const findUser: User = await UserModel.findOne({ _id: userId });\r\n    if (!findUser) throw new HttpException(409, \"User doesn't exist\");\r\n\r\n    return findUser;\r\n  }\r\n\r\n  public async createUser(userData: User): Promise<User> {\r\n    const findUser: User = await UserModel.findOne({ email: userData.email });\r\n    if (findUser) throw new HttpException(409, `This email ${userData.email} already exists`);\r\n\r\n    const hashedPassword = await hash(userData.password, 10);\r\n    const createUserData: User = await UserModel.create({ ...userData, password: hashedPassword });\r\n\r\n    return createUserData;\r\n  }\r\n\r\n  public async updateUser(userId: string, userData: User): Promise<User> {\r\n    if (userData.email) {\r\n      const findUser: User = await UserModel.findOne({ email: userData.email });\r\n      if (findUser && findUser._id != userId) throw new HttpException(409, `This email ${userData.email} already exists`);\r\n    }\r\n\r\n    if (userData.password) {\r\n      const hashedPassword = await hash(userData.password, 10);\r\n      userData = { ...userData, password: hashedPassword };\r\n    }\r\n\r\n    const updateUserById: User = await UserModel.findByIdAndUpdate(userId, { userData });\r\n    if (!updateUserById) throw new HttpException(409, \"User doesn't exist\");\r\n\r\n    return updateUserById;\r\n  }\r\n\r\n  public async deleteUser(userId: string): Promise<User> {\r\n    const deleteUserById: User = await UserModel.findByIdAndDelete(userId);\r\n    if (!deleteUserById) throw new HttpException(409, \"User doesn't exist\");\r\n\r\n    return deleteUserById;\r\n  }\r\n}\r\n"],"names":["UserService","findAllUser","users","UserModel","find","findUserById","userId","findUser","findOne","_id","HttpException","createUser","userData","email","hashedPassword","hash","password","createUserData","create","updateUser","updateUserById","findByIdAndUpdate","deleteUser","deleteUserById","findByIdAndDelete","Service"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPQ;wBACG;+BACM;4BAEJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAGbA,cAAN;IACL,MAAaC,cAA+B;QAC1C,MAAMC,QAAgB,MAAMC,qBAAS,CAACC,IAAI;QAC1C,OAAOF;IACT;IAEA,MAAaG,aAAaC,MAAc,EAAiB;QACvD,MAAMC,WAAiB,MAAMJ,qBAAS,CAACK,OAAO,CAAC;YAAEC,KAAKH;QAAO;QAC7D,IAAI,CAACC,UAAU,MAAM,IAAIG,4BAAa,CAAC,KAAK;QAE5C,OAAOH;IACT;IAEA,MAAaI,WAAWC,QAAc,EAAiB;QACrD,MAAML,WAAiB,MAAMJ,qBAAS,CAACK,OAAO,CAAC;YAAEK,OAAOD,SAASC,KAAK;QAAC;QACvE,IAAIN,UAAU,MAAM,IAAIG,4BAAa,CAAC,KAAK,CAAC,WAAW,EAAEE,SAASC,KAAK,CAAC,eAAe,CAAC;QAExF,MAAMC,iBAAiB,MAAMC,IAAAA,YAAI,EAACH,SAASI,QAAQ,EAAE;QACrD,MAAMC,iBAAuB,MAAMd,qBAAS,CAACe,MAAM,CAAC,wCAAKN;YAAUI,UAAUF;;QAE7E,OAAOG;IACT;IAEA,MAAaE,WAAWb,MAAc,EAAEM,QAAc,EAAiB;QACrE,IAAIA,SAASC,KAAK,EAAE;YAClB,MAAMN,WAAiB,MAAMJ,qBAAS,CAACK,OAAO,CAAC;gBAAEK,OAAOD,SAASC,KAAK;YAAC;YACvE,IAAIN,YAAYA,SAASE,GAAG,IAAIH,QAAQ,MAAM,IAAII,4BAAa,CAAC,KAAK,CAAC,WAAW,EAAEE,SAASC,KAAK,CAAC,eAAe,CAAC;QACpH;QAEA,IAAID,SAASI,QAAQ,EAAE;YACrB,MAAMF,iBAAiB,MAAMC,IAAAA,YAAI,EAACH,SAASI,QAAQ,EAAE;YACrDJ,WAAW,wCAAKA;gBAAUI,UAAUF;;QACtC;QAEA,MAAMM,iBAAuB,MAAMjB,qBAAS,CAACkB,iBAAiB,CAACf,QAAQ;YAAEM;QAAS;QAClF,IAAI,CAACQ,gBAAgB,MAAM,IAAIV,4BAAa,CAAC,KAAK;QAElD,OAAOU;IACT;IAEA,MAAaE,WAAWhB,MAAc,EAAiB;QACrD,MAAMiB,iBAAuB,MAAMpB,qBAAS,CAACqB,iBAAiB,CAAClB;QAC/D,IAAI,CAACiB,gBAAgB,MAAM,IAAIb,4BAAa,CAAC,KAAK;QAElD,OAAOa;IACT;AACF;AA9CavB;IADZyB,IAAAA,eAAO;GACKzB"}
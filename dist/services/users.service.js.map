{"version":3,"sources":["../../src/services/users.service.ts"],"sourcesContent":["import { hash } from 'bcrypt';\nimport { Service } from 'typedi';\nimport { HttpException } from '@exceptions/HttpException';\nimport { User } from '@interfaces/users.interface';\nimport { UserModel } from '@models/users.model';\n\n@Service()\nexport class UserService {\n  public async findAllUser(): Promise<User[]> {\n    const users: User[] = await UserModel.find();\n    return users;\n  }\n\n  public async findUserById(userId: string): Promise<User> {\n    const findUser: User = await UserModel.findOne({ _id: userId });\n    if (!findUser) throw new HttpException(409, \"User doesn't exist\");\n\n    return findUser;\n  }\n\n  public async createUser(userData: User): Promise<User> {\n    const findUser: User = await UserModel.findOne({ username: userData.username });\n    if (findUser) throw new HttpException(409, `This username ${userData.username} already exists`);\n\n    const hashedPassword = await hash(userData.password, 10);\n    const createUserData: User = await UserModel.create({ ...userData, password: hashedPassword });\n\n    return createUserData;\n  }\n\n  public async updateUser(userId: string, userData: User): Promise<User> {\n    if (userData.username) {\n      const findUser: User = await UserModel.findOne({ username: userData.username });\n      if (findUser && findUser._id != userId) throw new HttpException(409, `This username ${userData.username} already exists`);\n    }\n\n    if (userData.password) {\n      const hashedPassword = await hash(userData.password, 10);\n      userData = { ...userData, password: hashedPassword };\n    }\n\n    const updateUserById: User = await UserModel.findByIdAndUpdate(userId, userData);\n    if (!updateUserById) throw new HttpException(409, \"User doesn't exist\");\n\n    return updateUserById;\n  }\n\n  public async deleteUser(userId: string): Promise<User> {\n    const deleteUserById: User = await UserModel.findByIdAndDelete(userId);\n    if (!deleteUserById) throw new HttpException(409, \"User doesn't exist\");\n\n    return deleteUserById;\n  }\n}\n"],"names":["UserService","findAllUser","users","UserModel","find","findUserById","userId","findUser","findOne","_id","HttpException","createUser","userData","username","hashedPassword","hash","password","createUserData","create","updateUser","updateUserById","findByIdAndUpdate","deleteUser","deleteUserById","findByIdAndDelete"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPQ;wBACG;+BACM;4BAEJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGnB,IAAA,AAAMA,cAAN,MAAMA;IACX,MAAaC,cAA+B;QAC1C,MAAMC,QAAgB,MAAMC,qBAAS,CAACC,IAAI;QAC1C,OAAOF;IACT;IAEA,MAAaG,aAAaC,MAAc,EAAiB;QACvD,MAAMC,WAAiB,MAAMJ,qBAAS,CAACK,OAAO,CAAC;YAAEC,KAAKH;QAAO;QAC7D,IAAI,CAACC,UAAU,MAAM,IAAIG,4BAAa,CAAC,KAAK;QAE5C,OAAOH;IACT;IAEA,MAAaI,WAAWC,QAAc,EAAiB;QACrD,MAAML,WAAiB,MAAMJ,qBAAS,CAACK,OAAO,CAAC;YAAEK,UAAUD,SAASC,QAAQ;QAAC;QAC7E,IAAIN,UAAU,MAAM,IAAIG,4BAAa,CAAC,KAAK,CAAC,cAAc,EAAEE,SAASC,QAAQ,CAAC,eAAe,CAAC;QAE9F,MAAMC,iBAAiB,MAAMC,IAAAA,YAAI,EAACH,SAASI,QAAQ,EAAE;QACrD,MAAMC,iBAAuB,MAAMd,qBAAS,CAACe,MAAM,CAAC,wCAAKN;YAAUI,UAAUF;;QAE7E,OAAOG;IACT;IAEA,MAAaE,WAAWb,MAAc,EAAEM,QAAc,EAAiB;QACrE,IAAIA,SAASC,QAAQ,EAAE;YACrB,MAAMN,WAAiB,MAAMJ,qBAAS,CAACK,OAAO,CAAC;gBAAEK,UAAUD,SAASC,QAAQ;YAAC;YAC7E,IAAIN,YAAYA,SAASE,GAAG,IAAIH,QAAQ,MAAM,IAAII,4BAAa,CAAC,KAAK,CAAC,cAAc,EAAEE,SAASC,QAAQ,CAAC,eAAe,CAAC;QAC1H;QAEA,IAAID,SAASI,QAAQ,EAAE;YACrB,MAAMF,iBAAiB,MAAMC,IAAAA,YAAI,EAACH,SAASI,QAAQ,EAAE;YACrDJ,WAAW,wCAAKA;gBAAUI,UAAUF;;QACtC;QAEA,MAAMM,iBAAuB,MAAMjB,qBAAS,CAACkB,iBAAiB,CAACf,QAAQM;QACvE,IAAI,CAACQ,gBAAgB,MAAM,IAAIV,4BAAa,CAAC,KAAK;QAElD,OAAOU;IACT;IAEA,MAAaE,WAAWhB,MAAc,EAAiB;QACrD,MAAMiB,iBAAuB,MAAMpB,qBAAS,CAACqB,iBAAiB,CAAClB;QAC/D,IAAI,CAACiB,gBAAgB,MAAM,IAAIb,4BAAa,CAAC,KAAK;QAElD,OAAOa;IACT;AACF"}
{"version":3,"sources":["../src/app.ts"],"sourcesContent":["import 'reflect-metadata';\nimport compression from 'compression';\nimport cookieParser from 'cookie-parser';\nimport cors from 'cors';\nimport express from 'express';\nimport helmet from 'helmet';\nimport hpp from 'hpp';\nimport morgan from 'morgan';\nimport swaggerJSDoc from 'swagger-jsdoc';\nimport swaggerUi from 'swagger-ui-express';\nimport { NODE_ENV, PORT, LOG_FORMAT, ORIGIN, CREDENTIALS } from '@config';\nimport { dbConnection } from '@database';\nimport { Routes } from '@interfaces/routes.interface';\nimport { ErrorMiddleware } from '@middlewares/error.middleware';\nimport { logger, stream } from '@utils/logger';\nimport mongoose from 'mongoose';\n\nmongoose.set('strictQuery', false); // or true, depending on your needs\n\nexport class App {\n  public app: express.Application;\n  public env: string;\n  public port: string | number;\n\n  constructor(routes: Routes[]) {\n    this.app = express();\n    this.env = NODE_ENV || 'development';\n    this.port = PORT || 5000;\n\n    this.connectToDatabase();\n    this.initializeMiddlewares();\n    this.initializeRoutes(routes);\n    this.initializeSwagger();\n    this.initializeErrorHandling();\n  }\n\n  public listen() {\n    this.app.listen(this.port, () => {\n      logger.info(`=================================`);\n      logger.info(`======= ENV: ${this.env} =======`);\n      logger.info(`ðŸš€ App listening on the port ${this.port}`);\n      logger.info(`=================================`);\n    });\n  }\n\n  public getServer() {\n    return this.app;\n  }\n\n  private async connectToDatabase() {\n    await dbConnection();\n  }\n\n  private initializeMiddlewares() {\n    this.app.use(morgan(LOG_FORMAT, { stream }));\n    this.app.use(cors({ origin: 'http://localhost:3001', credentials: true })); // Update the origin as needed\n    this.app.use(hpp());\n    this.app.use(helmet());\n    this.app.use(compression());\n    this.app.use(express.json());\n    this.app.use(express.urlencoded({ extended: true }));\n    this.app.use(cookieParser());\n  }\n\n  private initializeRoutes(routes: Routes[]) {\n    routes.forEach(route => {\n      this.app.use('/', route.router);\n    });\n  }\n\n  private initializeSwagger() {\n    const options = {\n      swaggerDefinition: {\n        info: {\n          title: 'REST API',\n          version: '1.0.0',\n          description: 'Example docs',\n        },\n      },\n      apis: ['./src/routes/*.route.ts', './swagger.yaml'], // Ensure correct paths\n    };\n\n    try {\n      const specs = swaggerJSDoc(options);\n      this.app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(specs));\n      logger.info('Swagger initialized successfully');\n    } catch (error) {\n      logger.error('Error initializing Swagger:', error);\n      throw new Error('Failed to initialize Swagger'); // Rethrow to crash the app for debugging\n    }\n  }\n\n  private initializeErrorHandling() {\n    this.app.use(ErrorMiddleware);\n  }\n}"],"names":["App","mongoose","set","listen","app","port","logger","info","env","getServer","connectToDatabase","dbConnection","initializeMiddlewares","use","morgan","LOG_FORMAT","stream","cors","origin","credentials","hpp","helmet","compression","express","json","urlencoded","extended","cookieParser","initializeRoutes","routes","forEach","route","router","initializeSwagger","options","swaggerDefinition","title","version","description","apis","specs","swaggerJSDoc","swaggerUi","serve","setup","error","Error","initializeErrorHandling","ErrorMiddleware","constructor","NODE_ENV","PORT"],"mappings":"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"}